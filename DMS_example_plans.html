<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examples of Data Management & Sharing Plans</title>
    <!-- Tailwind CSS for modern, professional styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');
        
        /* Custom CSS to match the R-Shiny app's styles */
        body {
            font-family: 'Lato', sans-serif;
            background-color: #f0f4f8; /* Light gray-blue background */
        }
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }
        .app-title {
            color: #003366;
            font-weight: 700;
            font-size: 35px;
            text-align: center;
        }
        .sidebar-panel {
            background-color: #e3f2fd; /* Lighter blue */
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h4 {
            color: #004080;
            border-bottom: 2px solid #b3d9ff;
            padding-bottom: 5px;
            margin-top: 25px;
            font-weight: 700;
        }
        .form-control, .selectize-input {
            border-radius: 5px;
            border-color: #90caf9;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .iframe-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .logo-left img {
            height: 140px;
        }
        .logo-right img {
            height: 100px;
        }
        /* Style for the dynamic table */
        #results-table {
            border-collapse: collapse;
            width: 100%;
        }
        #results-table th, #results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        #results-table th {
            background-color: #b3d9ff;
            color: #003366;
            font-weight: 700;
        }
        #results-table tbody tr:nth-child(even) {
            background-color: #f4f9ff;
        }
        #results-table tbody tr {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #results-table tbody tr.selected {
            background-color: #cce5ff;
            font-weight: 600;
        }
        #results-table tbody tr:hover {
            background-color: #e9f5ff;
        }
        
        /* New CSS for the custom dropdown */
        .custom-dropdown {
            position: relative;
            margin-bottom: 15px;
        }
        .dropdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
        .dropdown-header .placeholder {
            color: #666;
        }
        .dropdown-header .selected-items {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            color: #333;
        }
        .dropdown-header .arrow {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }
        .dropdown-header.open .arrow {
            transform: rotate(180deg);
        }
        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #fff;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            padding: 5px 0;
        }
        .dropdown-options.show {
            display: block;
        }
        .dropdown-option {
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 14px;
        }
        .dropdown-option:hover {
            background-color: #f0f4f8;
        }
        .dropdown-option.selected {
            background-color: #e3f2fd;
            font-weight: 600;
            position: relative;
        }
        .dropdown-option.selected::after {
            content: '✔';
            position: absolute;
            right: 15px;
            color: #007bff;
        }
    </style>
</head>
<body class="p-6 md:p-10">

    <!-- Header with Logos -->
    <div class="header-container max-w-7xl mx-auto">
        <div class="logo-left">
            <img src="assets/images/DSC_logo.png" alt="DSC Logo" class="logo">
        </div>
        <h1 class="app-title flex-grow">Data Management & Sharing Plan Examples</h1>
        <div class="logo-right">
            <img src="assets/images/INBRE_logo.png" alt="INBRE Logo" class="logo">
        </div>
    </div>

    <!-- Main Content Layout -->
    <div class="flex flex-col md:flex-row gap-6 max-w-7xl mx-auto">
        <!-- Sidebar Panel -->
        <aside class="sidebar-panel md:w-1/4">
            <h4>Filters</h4>
            
            <div class="custom-dropdown" id="subject-dropdown">
                <label class="block text-sm font-medium text-gray-700">Subject Type:</label>
                <div class="dropdown-header">
                    <span class="selected-items">All</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="dropdown-options"></div>
            </div>
            
            <div class="custom-dropdown" id="institute-dropdown">
                <label class="block text-sm font-medium text-gray-700">Institute:</label>
                <div class="dropdown-header">
                    <span class="selected-items">All</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="dropdown-options"></div>
            </div>
            
            <div class="custom-dropdown" id="clinical-dropdown">
                <label class="block text-sm font-medium text-gray-700">Clinical/Non-Clinical/Biomedical:</label>
                <div class="dropdown-header">
                    <span class="selected-items">All</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="dropdown-options"></div>
            </div>
            
            <div class="custom-dropdown" id="research-dropdown">
                <label class="block text-sm font-medium text-gray-700">Research Area:</label>
                <div class="dropdown-header">
                    <span class="selected-items">All</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="dropdown-options"></div>
            </div>
            
            <div class="custom-dropdown" id="psdata-dropdown">
                <label class="block text-sm font-medium text-gray-700">Primary/Secondary Data Used:</label>
                <div class="dropdown-header">
                    <span class="selected-items">All</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="dropdown-options"></div>
            </div>
            
            <div class="custom-dropdown" id="datatype-dropdown">
                <label class="block text-sm font-medium text-gray-700">Data Type:</label>
                <div class="dropdown-header">
                    <span class="selected-items">All</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="dropdown-options"></div>
            </div>
            
            <div class="custom-dropdown" id="date-dropdown">
                <label class="block text-sm font-medium text-gray-700">Year Created:</label>
                <div class="dropdown-header">
                    <span class="selected-items">All</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="dropdown-options"></div>
            </div>
            
            <button id="reset-filters" class="btn-primary w-full mt-4">Reset Filters</button>
            <div class="text-right text-xs text-gray-500 mt-4" id="last-updated"></div>
        </aside>

        <!-- Main Panel -->
        <main class="main-panel-container flex-grow">
            <h4 class="mb-4">Matching Plans</h4>
            <div class="overflow-x-auto bg-white rounded-md shadow-sm p-4">
                <table id="results-table">
                    <thead>
                        <tr>
                            <th>Subject Type</th>
                            <th>Institute</th>
                            <th>Clinical/Non-Clinical/Biomedical</th>
                            <th>Research Area</th>
                            <th>Primary/Secondary Data Used</th>
                            <th>Data Type</th>
                            <th>Link</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Table rows will be inserted here -->
                    </tbody>
                </table>
            </div>
            <h4 class="mt-6 mb-4">Document Viewer</h4>
            <div class="iframe-container">
                <iframe id="doc-viewer" width="100%" height="600px" style="border:none;"></iframe>
            </div>
        </main>
    </div>

    <script>
        (function() {
            // Hard-coded data mirroring the structure of your CSV and file paths
            const dmsPlans = [
                { "Subject Type": "Human", "Institute": "NCI", "Clinical/Non-Clinical/Biomedical": "Non-Clinical", "Research Area": "Social Science", "Primary/Secondary Data used": "Primary", "Data Type": "Image, Video, Survey", "Date": "Post-2023", "Link": "example_plans/NCI-Social-Media-Sample-DMS-Plan_0.pdf" },
                { "Subject Type": "Human", "Institute": "NHGRI", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Social Science", "Primary/Secondary Data used": "Primary", "Data Type": "Survey", "Date": "Pre-2023", "Link": "example_plans/Survey-and-Interview-Data_Sample-DMS-Plan_05222023_1.pdf" },
                { "Subject Type": "Human", "Institute": "NHGRI", "Clinical/Non-Clinical/Biomedical": "Non-Clinical", "Research Area": "Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Sequencing", "Date": "Pre-2023", "Link": "example_plans/Human-Genomic-Data_NHGRI_Sample-DMS-Plan_v1.pdf" },
                { "Subject Type": "Non-Human", "Institute": "NHGRI", "Clinical/Non-Clinical/Biomedical": "Biomedical", "Research Area": "Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Sequencing", "Date": "Pre-2023", "Link": "example_plans/Technology-Development_NHGRI_Sample-DMS-Plan_v1.pdf" },
                { "Subject Type": "Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science", "Primary/Secondary Data used": "Primary", "Data Type": "EHR", "Date": "Post-2023", "Link": "example_plans/NIA_BSR_EHR_Data_MS_Plan_Example_final.pdf" },
                { "Subject Type": "Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Social Science, Public Health, Behavioral Science", "Primary/Secondary Data used": "Primary", "Data Type": "Survey, Interview", "Date": "Post-2023", "Link": "example_plans/NIA_BSR_Longitudinal_Restricted_Access_DMS_Plan_Example_final.pdf" },
                { "Subject Type": "Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Social Science, Public Health", "Primary/Secondary Data used": "Secondary", "Data Type": "EHR", "Date": "Post-2023", "Link": "example_plans/NIA_BSR_Secondary_Data_DMS_Plan_Example_final.pdf" },
                { "Subject Type": "Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science, Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Clinical test", "Date": "Pre-2023", "Link": "example_plans/ExampleDMSPlan_Human_Clinicalgenomics_NIHFormatPage_v2.pdf" },
                { "Subject Type": "Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science", "Primary/Secondary Data used": "Primary", "Data Type": "Clinical test", "Date": "Post-2023", "Link": "example_plans/NIA_DN_Clinical_Interventions_DMS_Plan_Example_final.pdf" },
                { "Subject Type": "Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science", "Primary/Secondary Data used": "Secondary", "Data Type": "Image, Clinical test", "Date": "Post-2023", "Link": "example_plans/NIA_DN_Secondary_data_analysis.pdf" },
                { "Subject Type": "Non-Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Non-Clinical", "Research Area": "Behavioral Science", "Primary/Secondary Data used": "Primary", "Data Type": "Video, Clinical test", "Date": "Post-2023", "Link": "example_plans/NIA_BSR_Primate_Data_DMS_Plan_Example_final.pdf" },
                { "Subject Type": "Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Survey", "Primary/Secondary Data used": "Primary", "Data Type": "Physical activity, Survey", "Date": "Post-2023", "Link": "example_plans/NIA_BSR_Survey_Interview_Data_DM_%20Plan_Example_final.pdf" },
                { "Subject Type": "Non-Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Biomedical", "Research Area": "Clinical Science, Neuroscience", "Primary/Secondary Data used": "Primary", "Data Type": "Video, Clinical test, Behavioral observations", "Date": "Post-2023", "Link": "example_plans/NIA_DN_animal_models_DMS_Plan_Example_final.pdf" },
                { "Subject Type": "Non-Human", "Institute": "NIA", "Clinical/Non-Clinical/Biomedical": "Biomedical", "Research Area": "Drug Development", "Primary/Secondary Data used": "Primary", "Data Type": "Image, pharmacokinetic", "Date": "Post-2023", "Link": "example_plans/NIA_DN_Intellectual_Prop_DMS_Plan_Example.pdf" },
                { "Subject Type": "Human", "Institute": "NICHD", "Clinical/Non-Clinical/Biomedical": "Non-Clinical", "Research Area": "Social Science", "Primary/Secondary Data used": "Primary", "Data Type": "Survey, Interview", "Date": "Pre-2023", "Link": "example_plans/Example_DMS_Plan-Human-Survey-NIH_Format_Page_V2.pdf" },
                { "Subject Type": "Human", "Institute": "NICHD", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science", "Primary/Secondary Data used": "Primary", "Data Type": "Clinical test", "Date": "Pre-2023", "Link": "example_plans/Example_DMS_Plan_Clinical-Trial-NIH_Format_Page.pdf" },
                { "Subject Type": "Human", "Institute": "NICHD", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science, Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Sequencing", "Date": "Post-2023", "Link": "example_plans/NIA_DN_AD_Human_Genomic_DMS_Plan_Example_final.pdf" },
                { "Subject Type": "Non-Human", "Institute": "NICHD", "Clinical/Non-Clinical/Biomedical": "Biomedical", "Research Area": "Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Sequencing", "Date": "Pre-2023", "Link": "example_plans/ExampleDMSPlan_NonHuman_Zebrafish_NIHFormatPage_v2.pdf" },
                { "Subject Type": "Human", "Institute": "NIDDK", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science", "Primary/Secondary Data used": "Primary", "Data Type": "Clinical test", "Date": "Post-2023", "Link": "example_plans/PI-E01BNIDDKDMSPlanExampleClinical.pdf" },
                { "Subject Type": "Human", "Institute": "NIDDK", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science", "Primary/Secondary Data used": "Secondary", "Data Type": "Image", "Date": "Post-2023", "Link": "example_plans/PI-E01DNIDDKDMSPlanExampleSecondaryAnalysis.pdf" },
                { "Subject Type": "Non-Human", "Institute": "NIDDK", "Clinical/Non-Clinical/Biomedical": "Biomedical", "Research Area": "Clinical Science, Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Sequencing, Image", "Date": "Post-2023", "Link": "example_plans/PIE01ANIDDKDMSPlanExampleNonhumanBasicResearch.pdf" },
                { "Subject Type": "Human", "Institute": "NIMH", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Sequencing", "Date": "Post-2023", "Link": "example_plans/NIMH_Human-Genomic_Template_v3.pdf" },
                { "Subject Type": "Human", "Institute": "NIMH", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Neuroscience", "Primary/Secondary Data used": "Secondary", "Data Type": "Image, Clinical test", "Date": "Post-2023", "Link": "example_plans/NIMH_Secondary-Data-Analysis_Template_v3.pdf" },
                { "Subject Type": "Human", "Institute": "NIMH", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science", "Primary/Secondary Data used": "Primary", "Data Type": "Image, Clinical test", "Date": "Post-2023", "Link": "example_plans/NIMH_Human MRI and Clinical Assessments_Template_v3.pdf" },
                { "Subject Type": "Non-Human", "Institute": "NIMH", "Clinical/Non-Clinical/Biomedical": "Biomedical", "Research Area": "Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Cell, Sequencing", "Date": "Post-2023", "Link": "example_plans/NIMH_Mouse-Genomic-Template_v3.pdf" },
                { "Subject Type": "Non-Human", "Institute": "OD, NHGRI", "Clinical/Non-Clinical/Biomedical": "Biomedical", "Research Area": "Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Sequencing", "Date": "Pre-2023", "Link": "example_plans/Whole-Genome-Data-Fro-HeLa-Cell-Lines_ Sample-DMS-Plan.pdf" },
                { "Subject Type": "Human", "Institute": "OD, NHGRI", "Clinical/Non-Clinical/Biomedical": "Clinical", "Research Area": "Clinical Science, Genomics", "Primary/Secondary Data used": "Primary", "Data Type": "Clinical test, Genomics, Metabolomics", "Date": "Post-2023", "Link": "example_plans/final_DMSPlan_2023_Cu.pdf" }
            ];

            // Dynamically generate the list of filter categories from the data
            const getUniqueValues = (data, field) => {
                const allValues = data.flatMap(plan => {
                    if (plan[field] && typeof plan[field] === 'string') {
                        return plan[field].split(',').map(s => s.trim()).filter(s => s !== '');
                    }
                    return [];
                });
                return [...new Set(allValues)].sort();
            };

            const filterCategories = {
                "Subject Type": getUniqueValues(dmsPlans, "Subject Type"),
                "Institute": getUniqueValues(dmsPlans, "Institute"),
                "Clinical/Non-Clinical/Biomedical": getUniqueValues(dmsPlans, "Clinical/Non-Clinical/Biomedical"),
                "Research Area": getUniqueValues(dmsPlans, "Research Area"),
                "Primary/Secondary Data used": getUniqueValues(dmsPlans, "Primary/Secondary Data used"),
                "Data Type": getUniqueValues(dmsPlans, "Data Type"),
                "Date": getUniqueValues(dmsPlans, "Date")
            };

            // --- DOM Element References ---
            const dropdowns = {
                "Subject Type": document.getElementById('subject-dropdown'),
                "Institute": document.getElementById('institute-dropdown'),
                "Clinical/Non-Clinical/Biomedical": document.getElementById('clinical-dropdown'),
                "Research Area": document.getElementById('research-dropdown'),
                "Primary/Secondary Data used": document.getElementById('psdata-dropdown'),
                "Data Type": document.getElementById('datatype-dropdown'),
                "Date": document.getElementById('date-dropdown')
            };

            const resetButton = document.getElementById('reset-filters');
            const tableBody = document.querySelector('#results-table tbody');
            const docViewer = document.getElementById('doc-viewer');
            const lastUpdatedDiv = document.getElementById('last-updated');
            
            // Populates a custom dropdown with the correct options.
            const populateDropdown = (dropdownId, dataField) => {
                const container = document.getElementById(dropdownId).querySelector('.dropdown-options');
                container.innerHTML = '';
                
                const allOption = document.createElement('div');
                allOption.textContent = 'All';
                allOption.classList.add('dropdown-option', 'selected');
                allOption.dataset.value = '';
                container.appendChild(allOption);

                const values = filterCategories[dataField] || [];
                values.forEach(value => {
                    const option = document.createElement('div');
                    option.textContent = value;
                    option.classList.add('dropdown-option');
                    option.dataset.value = value;
                    container.appendChild(option);
                });
            };
            
            const updateDropdownHeader = (dropdownContainer) => {
                const selectedItems = Array.from(dropdownContainer.querySelectorAll('.dropdown-option.selected'))
                    .map(el => el.textContent)
                    .filter(text => text !== 'All');
                
                const headerText = dropdownContainer.querySelector('.selected-items');
                if (selectedItems.length > 0) {
                    headerText.textContent = selectedItems.join(', ');
                } else {
                    headerText.textContent = 'All';
                }
            };
            
            const renderTable = (filteredPlans) => {
                tableBody.innerHTML = '';
                if (filteredPlans.length === 0) {
                    const noResultsRow = document.createElement('tr');
                    noResultsRow.innerHTML = `<td colspan="7" class="text-center text-gray-500 py-4">No plans found. Please adjust your filters.</td>`;
                    tableBody.appendChild(noResultsRow);
                } else {
                    filteredPlans.forEach(plan => {
                        const row = document.createElement('tr');
                        row.dataset.url = plan.Link;
                        row.innerHTML = `
                            <td>${plan["Subject Type"]}</td>
                            <td>${plan.Institute}</td>
                            <td>${plan["Clinical/Non-Clinical/Biomedical"]}</td>
                            <td>${plan["Research Area"]}</td>
                            <td>${plan["Primary/Secondary Data used"]}</td>
                            <td>${plan["Data Type"]}</td>
                            <td><a href="${plan.Link}" target="_blank" class="text-blue-600 hover:underline">View</a></td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            };

            const filterData = () => {
                let filtered = [...dmsPlans];

                const getSelectedValues = (dropdownId) => {
                    const selectedOptions = document.getElementById(dropdownId).querySelectorAll('.dropdown-option.selected');
                    const values = Array.from(selectedOptions).map(el => el.dataset.value);
                    return values.filter(v => v !== '');
                };

                const filterByIntersection = (data, field, selectedValues) => {
                    if (selectedValues.length === 0) return data;
                    return data.filter(plan => {
                        const planValues = plan[field].split(',').map(s => s.trim());
                        return selectedValues.some(val => planValues.includes(val));
                    });
                };

                filtered = filterByIntersection(filtered, "Subject Type", getSelectedValues('subject-dropdown'));
                filtered = filterByIntersection(filtered, "Institute", getSelectedValues('institute-dropdown'));
                filtered = filterByIntersection(filtered, "Clinical/Non-Clinical/Biomedical", getSelectedValues('clinical-dropdown'));
                filtered = filterByIntersection(filtered, "Research Area", getSelectedValues('research-dropdown'));
                filtered = filterByIntersection(filtered, "Primary/Secondary Data used", getSelectedValues('psdata-dropdown'));
                filtered = filterByIntersection(filtered, "Data Type", getSelectedValues('datatype-dropdown'));
                filtered = filterByIntersection(filtered, "Date", getSelectedValues('date-dropdown'));

                return filtered;
            };

            const handleFilterChange = () => {
                const filteredPlans = filterData();
                renderTable(filteredPlans);
                docViewer.src = '';
            };
            
            const handleDropdownClick = (event) => {
                const header = event.target.closest('.dropdown-header');
                const dropdownContainer = event.target.closest('.custom-dropdown');
                
                if (header) {
                    const options = dropdownContainer.querySelector('.dropdown-options');
                    options.classList.toggle('show');
                    header.classList.toggle('open');
                } else if (event.target.classList.contains('dropdown-option')) {
                    const clickedOption = event.target;
                    const container = clickedOption.closest('.custom-dropdown');
                    const optionsContainer = container.querySelector('.dropdown-options');
                    const isAllOption = clickedOption.dataset.value === '';

                    if (isAllOption) {
                        Array.from(optionsContainer.children).forEach(option => option.classList.remove('selected'));
                        clickedOption.classList.add('selected');
                    } else {
                        container.querySelector('[data-value=""]').classList.remove('selected');
                        clickedOption.classList.toggle('selected');

                        const selectedCount = Array.from(optionsContainer.children).filter(option => option.classList.contains('selected')).length;
                        if (selectedCount === 0) {
                           container.querySelector('[data-value=""]').classList.add('selected');
                        }
                    }
                    updateDropdownHeader(container);
                    handleFilterChange();
                }
            };

            const handleTableClick = (event) => {
                const row = event.target.closest('tr');
                if (row && row.dataset.url) {
                    document.querySelectorAll('#results-table tbody tr').forEach(r => r.classList.remove('selected'));
                    row.classList.add('selected');
                    docViewer.src = row.dataset.url;
                }
            };
            
            const handleReset = () => {
                Object.values(dropdowns).forEach(dropdown => {
                    const options = dropdown.querySelector('.dropdown-options');
                    Array.from(options.children).forEach(option => option.classList.remove('selected'));
                    options.querySelector('[data-value=""]').classList.add('selected');
                    updateDropdownHeader(dropdown);
                });
                renderTable(dmsPlans);
                docViewer.src = '';
            };

            const initializeApp = () => {
                // Populate dropdowns with the correct, explicitly defined categories
                populateDropdown('subject-dropdown', "Subject Type");
                populateDropdown('institute-dropdown', "Institute");
                populateDropdown('clinical-dropdown', "Clinical/Non-Clinical/Biomedical");
                populateDropdown('research-dropdown', "Research Area");
                populateDropdown('psdata-dropdown', "Primary/Secondary Data used");
                populateDropdown('datatype-dropdown', "Data Type");
                populateDropdown('date-dropdown', "Date");

                Object.values(dropdowns).forEach(dropdown => {
                    dropdown.addEventListener('click', handleDropdownClick);
                });
                resetButton.addEventListener('click', handleReset);
                tableBody.addEventListener('click', handleTableClick);

                const lastUpdated = new Date().toLocaleDateString('en-US', {
                    year: 'numeric', month: 'long', day: 'numeric'
                });
                lastUpdatedDiv.textContent = `Last Updated: ${lastUpdated}`;

                renderTable(dmsPlans);
            };

            initializeApp();
        })();
    </script>
        </div>
         </p>
        <hr class="border-t border-gray-300 my-6">
        <p class="text-sm italic text-center text-gray-500 mt-4">
            Alaska INBRE is an Institutional Development Award (IDeA) from the National Institute of General Medical Sciences of the National Institute of Health (NIH) under grant number P20GM103395. The content in this publication is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health.
        </p>
    </div>
</body>
</html>